{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://auto.id/schemas/reputation-attestation.schema.json",
  "title": "Reputation Attestation",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "type": { "type": "string", "const": "ReputationAttestation" },
    "schema": { "type": "string", "format": "uri" },
    "issuer": { "type": "string", "minLength": 1 },
    "subject": { "type": "string", "minLength": 1 },
    "event": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "category": { "type": "string", "minLength": 1 },
        "name": { "type": "string", "minLength": 1 },
        "severity": { "type": "integer", "minimum": 0, "maximum": 5 }
      },
      "required": ["category", "name", "severity"]
    },
    "task": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "id": { "type": "string", "minLength": 1 },
        "contextId": { "type": "string", "minLength": 1 }
      }
    },
    "artifacts": {
      "type": "array",
      "items": { "$ref": "#/$defs/contentReference" }
    },
    "evidence": {
      "type": "array",
      "items": { "$ref": "#/$defs/contentReference" }
    },
    "issuedAt": { "type": "string", "format": "date-time" },
    "expiresAt": {
      "oneOf": [{ "type": "string", "format": "date-time" }, { "type": "null" }]
    }
  },
  "required": ["type", "issuer", "subject", "event", "issuedAt"],
  "$defs": {
    "contentReference": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "cid": { "type": "string", "minLength": 10 },
        "hash": {
          "type": "string",
          "pattern": "^(sha(256|512)):[A-Fa-f0-9]{64,128}$"
        },
        "storage": {
          "type": "string",
          "enum": ["auto-drive", "ipfs", "http", "https", "s3", "other"]
        },
        "gatewayUri": { "type": "string", "format": "uri" }
      },
      "required": ["cid"]
    }
  },
  "examples": [
    {
      "type": "ReputationAttestation",
      "schema": "https://auto.id/schemas/reputation-attestation/v1",
      "issuer": "did:web:issuer.example",
      "subject": "did:web:agent.example",
      "event": {
        "category": "reliability",
        "name": "task_completed",
        "severity": 1
      },
      "task": { "id": "a2a-task-1234", "contextId": "ctx-abc" },
      "artifacts": [
        {
          "cid": "bafy...",
          "hash": "sha256:...",
          "storage": "auto-drive",
          "gatewayUri": "https://gateway.autonomys.xyz/bafy..."
        }
      ],
      "evidence": [
        { "cid": "bafy...", "hash": "sha256:...", "storage": "auto-drive" }
      ],
      "issuedAt": "2025-06-01T12:00:00Z",
      "expiresAt": null
    }
  ]
}
